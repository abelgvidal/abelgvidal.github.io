<!doctype html><html><head><title>Abel's notes - ¿Qué ocurre cuando Kubernetes elimina un pod? </title><link rel=stylesheet type=text/css href=/css/fonts.css><link rel=stylesheet type=text/css href=/css/fontawesome.css><link rel=stylesheet type=text/css href=/css/styles.min.d1b3428734153d8c3b5e2f3598da20a6372f630ae87c763594b98c554c580343.css><meta charset=UTF-8><meta name=author content="Abel González Vidal"><meta name=viewport content="width=device-width,initial-scale=1"><script async src="https://www.googletagmanager.com/gtag/js?id=G-37PFXMQRGD"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-37PFXMQRGD")</script><script type=text/javascript async src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><header class=page-header><div class=myname><h2><a href=https://blog.lpsz.org/>Abel's notes</a></h2></div><nav><ul class=navbar><li><a href=/tags/til><span>TIL</span></a></li><li><a href=/posts><span>Archive</span></a></li><li><a href=/tags/books/><span>Books</span></a></li><li><a href=/posts/aboutme/><span>About me</span></a></li></ul></nav></header><div id=content><main><article><h1 class="page-title blog">¿Qué ocurre cuando Kubernetes elimina un pod?</h1><p class=blog-post-info>Posted: <time>2025-12-15</time>
<span class=blog-taxonomy-info>&nbsp; | &nbsp; Tags:
<a class=blog-taxonomy-info href=/tags/kubernetes>kubernetes</a></span></p><div class=blog-post-content><p>La terminación elegante de pods en Kubernetes es fundamental para evitar la pérdida de datos, minimizar interrupciones y garantizar que los servicios se detengan de forma controlada. Este proceso ocurre cuando Kubernetes elimina un pod, ya sea por una actualización de un Deployment, un escalado, un eviction por falta de recursos, o cuando el usuario elimina manualmente el pod. Comprender cómo funciona la terminación elegante ayuda a diseñar aplicaciones más robustas.</p><p>Cuando Kubernetes quiere terminar un pod, le da la oportunidad de finalizar de forma elegante (gracefully).</p><ul><li>El hook preStop (si existe) se ejecuta antes de matar el pod. Es un buen lugar para:<ul><li>poner código que espere a que se cierren las conexiones</li><li>notificar a otros componentes</li><li>limpiar recursos</li></ul></li></ul><p>Por ejemplo, puedes definir un hook preStop y configurar el tiempo de gracia (terminationGracePeriodSeconds) tanto en el manifiesto de un Pod como en un Deployment. A continuación se muestra cómo hacerlo en un Deployment, que es el recurso más habitual:</p><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8b008b;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>ejemplo-graceful<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#b452cd>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>selector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>app</span>:<span style=color:#bbb> </span>ejemplo-graceful<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>template</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#8b008b;font-weight:700>app</span>:<span style=color:#bbb> </span>ejemplo-graceful<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>terminationGracePeriodSeconds</span>:<span style=color:#bbb> </span><span style=color:#b452cd>60</span><span style=color:#bbb>  </span><span style=color:#228b22># Tiempo de gracia personalizado (por defecto son 30 segundos)</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>containers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- <span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>app<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#8b008b;font-weight:700>image</span>:<span style=color:#bbb> </span>tu-imagen<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#8b008b;font-weight:700>lifecycle</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span><span style=color:#8b008b;font-weight:700>preStop</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:#8b008b;font-weight:700>exec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span><span style=color:#8b008b;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#cd5555>&#34;/bin/sh&#34;</span>,<span style=color:#bbb> </span><span style=color:#cd5555>&#34;-c&#34;</span>,<span style=color:#bbb> </span><span style=color:#cd5555>&#34;echo &#39;Cerrando conexiones...&#39; &amp;&amp; sleep 10&#34;</span>]<span style=color:#bbb>
</span></span></span></code></pre></div><ul><li>Kubernetes marca el pod con status=TERMINATING</li><li>Kubernetes marca el pod como NotReady</li><li>Al estar marcado como NotReady, su endpoint se elimina de los endpoints del servicio (ya no recibe tráfico)</li><li>Luego, Kubernetes envía al pod una señal SIGTERM al proceso principal de cada contenedor del pod.</li><li>Esto permite un periodo (por defecto 30 segundos, configurable con terminationGracePeriodSeconds) para que el proceso termine por sí mismo.</li><li>Si el proceso no termina por sí mismo, Kubernetes envía una señal SIGKILL al proceso principal de cada contenedor del pod.</li></ul><p>En resumen, aprovechar los mecanismos de terminación elegante en Kubernetes permite que tus aplicaciones gestionen correctamente el cierre de conexiones, la notificación a otros servicios y la liberación de recursos. Configura siempre el tiempo de gracia según las necesidades de tu aplicación y utiliza el hook preStop para evitar interrupciones o pérdidas de datos innecesarias.</p></div></article></main></div><footer><span></span></footer></body></html>